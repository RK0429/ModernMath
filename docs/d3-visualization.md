# D3.js Interactive Visualizations Guide

## Overview

The Math Knowledge Graph Wiki includes interactive D3.js visualizations that allow users to explore the local graph neighborhood of any mathematical concept. These visualizations are embedded directly into content pages and provide an interactive way to understand relationships between concepts.

## Features

- **Interactive Force-Directed Layout**: Nodes are positioned using D3's force simulation for optimal clarity
- **Drag and Drop**: Nodes can be dragged to rearrange the layout
- **Zoom and Pan**: Use mouse wheel to zoom, click and drag to pan
- **Color-Coded Nodes**: Different colors for Definitions, Theorems, Axioms, and Examples
- **Hover Information**: Hover over nodes to see detailed information
- **Focus Highlighting**: The current node is highlighted with a larger size
- **Directed Edges**: Arrows show dependency direction (A â†’ B means A uses/depends on B)

## How to Use in Content Pages

To add an interactive D3.js visualization to any Quarto content page, use the following syntax:

```markdown
::: {.graph-viz data-id="node-id" data-width="700" data-height="500"}
:::
```

Parameters:
- `data-id`: The ID of the node (e.g., "def-group", "thm-pythagorean")
- `data-width`: Width of the visualization in pixels (default: 700)
- `data-height`: Height of the visualization in pixels (default: 500)

### Example

```markdown
## Interactive Visualization

Explore the local knowledge graph neighborhood:

::: {.graph-viz data-id="def-group" data-width="800" data-height="600"}
:::
```

## Color Legend

- **Green** (#4CAF50): Definitions
- **Blue** (#2196F3): Theorems, Lemmas, Propositions, Corollaries
- **Orange** (#FF9800): Axioms
- **Purple** (#9C27B0): Examples

## Technical Details

### Data Generation

D3.js visualization data is generated by the `scripts/generate_d3_data.py` script, which:

1. Queries the RDF knowledge graph for each node
2. Extracts the local neighborhood (default depth: 2)
3. Converts RDF data to D3.js-compatible JSON format
4. Saves JSON files to `output/d3-data/`

### JSON Data Structure

Each node's data file contains:

```json
{
  "nodes": [
    {
      "id": "node-id",
      "uri": "https://mathwiki.org/resource/node-id",
      "label": "Human-readable label",
      "type": "Definition|Theorem|Axiom|Example",
      "index": 0,
      "is_focus": true|false
    }
  ],
  "links": [
    {
      "source": 0,  // Index of source node
      "target": 1,  // Index of target node
      "type": "uses"
    }
  ],
  "focus_node": "current-node-id",
  "metadata": {
    "total_nodes": 10,
    "total_links": 15,
    "depth": 2
  }
}
```

### Quarto Extension

The visualization is implemented as a Quarto extension located at `_extensions/graph-viz/`:

- `_extension.yml`: Extension configuration
- `graph-viz.lua`: Lua filter that processes the graph-viz shortcode

The extension:
1. Detects `{.graph-viz}` blocks in content
2. Generates HTML with embedded D3.js code
3. Loads the appropriate JSON data file
4. Renders the interactive visualization

## Adding Visualizations to New Content

When creating new mathematical content:

1. Ensure the node has a unique ID in its YAML front matter
2. Run `poetry run python scripts/build_graph.py` to update the knowledge graph
3. Run `poetry run python scripts/generate_d3_data.py` to generate visualization data
4. Add the visualization shortcode to your content file

## Troubleshooting

### Visualization Not Loading

1. Check that the node ID exists in the knowledge graph
2. Verify the JSON file exists in `output/d3-data/`
3. Check browser console for JavaScript errors
4. Ensure you're viewing the site through a web server (not file://)

### Missing Nodes or Links

1. Verify all cross-references use the `@label` syntax
2. Run the graph validation script: `poetry run python scripts/validate_graph.py`
3. Regenerate the D3 data files

### Performance Issues

For very large neighborhoods:
- Consider reducing the depth parameter in `generate_d3_data.py`
- Implement pagination or filtering for nodes with many connections

## CI/CD Integration

The D3.js visualization generation is integrated into the CI/CD pipeline:

1. Graph building (`scripts/build_graph.py`)
2. D3 data generation (`scripts/generate_d3_data.py`)
3. Quarto site rendering with embedded visualizations
4. Deployment to GitHub Pages

All visualization data is automatically regenerated on each commit to ensure consistency.

## Future Enhancements

Potential improvements for the visualization system:

- Add node filtering by type or domain
- Implement path highlighting between nodes
- Add graph statistics panel
- Support for full-page graph exploration
- Export functionality (SVG, PNG)
- Search within the visualization
- Collapsible node groups

## Related Documentation

- [PyVis Visualizations](./pyvis-visualization.md) - Standalone HTML visualizations
- [Mermaid Diagrams](./mermaid-diagrams.md) - Static graph diagrams
- [API Documentation](../api/README.md) - REST API for graph queries